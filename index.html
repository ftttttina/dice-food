<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>ğŸ² æ‘‡ä¸€æ‘‡é€‰æ™šé¤</title>
  <style>
    :root { --accent: #ffcc00; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #111; color: #fff; text-align: center;
      padding: 20px; margin: 0; min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
    }
    h1 { font-size: 1.8rem; }
    .dice-container { display: flex; gap: 20px; margin: 30px 0; font-size: 60px; }
    .rolling { animation: shake 0.1s infinite; }
    @keyframes shake {
      0% { transform: translate(2px, 1px); }
      50% { transform: translate(-1px, -2px); }
      100% { transform: translate(1px, 2px); }
    }
    button {
      background: var(--accent); color: #000; border: none;
      padding: 15px 30px; font-size: 1rem; font-weight: bold;
      border-radius: 50px; cursor: pointer; margin: 10px;
    }
    #motionBtn { background: #444; color: #fff; font-size: 0.8rem; }
    .result-card {
      margin-top: 30px; padding: 20px; border-radius: 20px;
      background: rgba(255,255,255,0.1); width: 90%; max-width: 350px;
    }
  </style>
</head>
<body>

  <h1>ğŸ² æ™šä¸Šåƒä»€ä¹ˆï¼Ÿ</h1>
  <p style="opacity: 0.6;">ç‚¹å‡»æŒ‰é’®æˆ–æ‘‡æ™ƒæ‰‹æœº</p>

  <div class="dice-container">
    <div id="dice1">ğŸ²</div>
    <div id="dice2">ğŸ²</div>
  </div>

  <button id="rollBtn" onclick="rollDice()">æ‰‹åŠ¨æ·éª°å­</button>
  
  <button id="motionBtn" onclick="requestPermission()">ç‚¹æ­¤å¼€å¯â€œæ‘‡ä¸€æ‘‡â€åŠŸèƒ½</button>

  <div id="result"></div>

  <script>
    // --- æ ¸å¿ƒé€»è¾‘ï¼šæ·éª°å­ ---
    function rollDice() {
      const d1 = document.getElementById("dice1");
      const d2 = document.getElementById("dice2");
      const btn = document.getElementById("rollBtn");
      if (btn.disabled) return;

      btn.disabled = true;
      d1.classList.add("rolling");
      d2.classList.add("rolling");

      setTimeout(() => {
        d1.classList.remove("rolling");
        d2.classList.remove("rolling");
        d1.textContent = Math.floor(Math.random() * 6) + 1;
        d2.textContent = Math.floor(Math.random() * 6) + 1;
        
        document.getElementById("result").innerHTML = `
          <div class="result-card">
            <h3>åƒç«é”…å§ï¼ğŸ”¥</h3>
            <p>"äººç”Ÿè‹¦çŸ­ï¼Œè‚‰è¦å¤§ç¢—ã€‚"</p>
          </div>
        `;
        btn.disabled = false;
      }, 1000);
    }

    // --- æ ¸å¿ƒé€»è¾‘ï¼šé‡åŠ›æ„Ÿåº” (Safari å…¼å®¹) ---
    let lastUpdate = 0;
    let lastX, lastY, lastZ;
    const threshold = 15; // æ‘‡æ™ƒé˜ˆå€¼ï¼Œæ•°å€¼è¶Šå¤§éœ€è¦è¶Šç”¨åŠ›

    function requestPermission() {
      // æ£€æŸ¥æ˜¯å¦ä¸º iOS è®¾å¤‡ä¸”éœ€è¦æˆæƒ
      if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              startMotionListener();
              document.getElementById("motionBtn").style.display = "none";
            }
          })
          .catch(console.error);
      } else {
        // é iOS 13+ è®¾å¤‡ï¼ˆå®‰å“ç­‰ï¼‰ç›´æ¥å¼€å¯
        startMotionListener();
        document.getElementById("motionBtn").textContent = "æ‘‡ä¸€æ‘‡å·²å¼€å¯";
      }
    }

    function startMotionListener() {
      window.addEventListener('devicemotion', (event) => {
        const acc = event.accelerationIncludingGravity;
        const curTime = new Date().getTime();

        if ((curTime - lastUpdate) > 100) {
          const diffTime = curTime - lastUpdate;
          lastUpdate = curTime;

          const speed = Math.abs(acc.x + acc.y + acc.z - lastX - lastY - lastZ) / diffTime * 10000;

          if (speed > 800) { // æ‘‡æ™ƒé€Ÿåº¦åˆ¤å®š
            rollDice();
          }

          lastX = acc.x;
          lastY = acc.y;
          lastZ = acc.z;
        }
      });
    }
  </script>
</body>
</html>
