<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DESTINY DINNER - ULTIMATE</title>
  <style>
    :root {
      --bg: #000;
      --light-x: 50%;
      --light-y: 50%;
    }
    body, html {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background: var(--bg); overflow: hidden;
      font-family: "SF Pro Display", -apple-system, sans-serif; color: #fff;
    }

    /* --- 強烈動態光影背景 --- */
    #ambient {
      position: absolute; width: 100%; height: 100%;
      background: 
        radial-gradient(circle at var(--light-x) var(--light-y), rgba(255,255,255,0.15) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, #1a1a1c 0%, #000 80%);
      z-index: 0;
    }

    /* --- 物理物件 --- */
    #world { position: absolute; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    .dice-obj { position: absolute; width: 64px; height: 64px; perspective: 1000px; will-change: transform; }
    .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; }
    .cube div {
      position: absolute; width: 64px; height: 64px;
      background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px;
      display: grid; padding: 10px; box-sizing: border-box;
    }

    /* 點數樣式 */
    .dot { width: 10px; height: 10px; background: #fff; border-radius: 50%; align-self: center; justify-self: center; box-shadow: 0 0 8px #fff; }
    .f1 { transform: rotateY(0deg) translateZ(32px); }
    .f6 { transform: rotateY(180deg) translateZ(32px); }
    .f2 { transform: rotateX(90deg) translateZ(32px); }
    .f5 { transform: rotateX(-90deg) translateZ(32px); }
    .f3 { transform: rotateY(90deg) translateZ(32px); }
    .f4 { transform: rotateY(-90deg) translateZ(32px); }

    /* --- 結果顯示區 --- */
    .result-container {
      position: absolute; top: 40%; width: 100%; text-align: center;
      z-index: 5; pointer-events: none;
    }
    #food-name { font-size: 2rem; font-weight: 200; letter-spacing: 10px; margin: 0; opacity: 0; transition: 1.5s; }
    #food-sub { font-size: 0.6rem; letter-spacing: 4px; opacity: 0; margin-top: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; transition: 2s; }

    /* --- 控制面板 --- */
    .controls { position: absolute; bottom: 8vh; width: 100%; display: flex; justify-content: center; gap: 15px; z-index: 10; }
    .btn {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2);
      color: #fff; padding: 15px 30px; border-radius: 40px; font-size: 0.7rem; letter-spacing: 2px;
      cursor: pointer; backdrop-filter: blur(10px); -webkit-tap-highlight-color: transparent;
    }
    .btn.active { background: #fff; color: #000; }
  </style>
</head>
<body>

<div id="ambient"></div>
<div id="world">
  <div id="d1" class="dice-obj"><div class="cube" id="c1">
    <div class="f1"><span class="dot"></span></div>
    <div class="f6" style="display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
    <div class="f2" style="display:flex; justify-content:space-between;"><span class="dot"></span><span class="dot" style="align-self:flex-end"></span></div>
    <div class="f5" style="display:grid; grid-template-columns:1fr 1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot" style="grid-area:2/2"></span></div>
    <div class="f3" style="display:grid; grid-template-columns:1fr 1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot" style="grid-area:1/1"></span><span class="dot" style="grid-area:2/2"></span><span class="dot" style="grid-area:3/3"></span></div>
    <div class="f4" style="display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
  </div></div>
  <div id="d2" class="dice-obj"><div class="cube" id="c2">
    <div class="f1"><span class="dot"></span></div>
    <div class="f6" style="display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
    <div class="f2" style="display:flex; justify-content:space-between;"><span class="dot"></span><span class="dot" style="align-self:flex-end"></span></div>
    <div class="f5" style="display:grid; grid-template-columns:1fr 1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot" style="grid-area:2/2"></span></div>
    <div class="f3" style="display:grid; grid-template-columns:1fr 1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot" style="grid-area:1/1"></span><span class="dot" style="grid-area:2/2"></span><span class="dot" style="grid-area:3/3"></span></div>
    <div class="f4" style="display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
  </div></div>
</div>

<div class="result-container">
  <h2 id="food-name"></h2>
  <div id="food-sub"></div>
</div>

<div class="controls">
  <button class="btn" onclick="shake()">SHAKE</button>
  <button class="btn" id="motionBtn" onclick="toggleMotion()">MOTION: OFF</button>
</div>

<script>
  // --- 菜單數據 (精簡版，可自行按格式擴充) ---
  const menuData = {
    morning: ["舒肥雞沙拉", "精品手沖", "酪梨吐司", "日式飯糰", "希臘優格"],
    noon: ["精緻便當", "牛肉麵", "海南雞飯", "義大利麵", "石鍋拌飯"],
    evening: ["熟成牛排", "麻辣火鍋", "職人壽司", "法式油封鴨", "居酒屋"],
    midnight: ["深夜拉麵", "串燒盛合", "鹽酥雞", "永和豆漿", "韓式炸雞"]
  };

  let dice = [
    { el: document.getElementById('d1'), c: document.getElementById('c1'), x: 100, y: 200, vx: 0, vy: 0, rx: 0, ry: 0 },
    { el: document.getElementById('d2'), c: document.getElementById('c2'), x: 250, y: 250, vx: 0, vy: 0, rx: 0, ry: 0 }
  ];

  let useMotion = false, gX = 0, gY = 0, isRolling = false;
  const bounce = 0.6, friction = 0.98;

  function shake() {
    isRolling = true;
    document.getElementById('food-name').style.opacity = 0;
    document.getElementById('food-sub').style.opacity = 0;
    dice.forEach(d => {
      d.vx += (Math.random()-0.5)*50;
      d.vy += (Math.random()-0.5)*50;
    });
  }

  function toggleMotion() {
    if (!useMotion) {
      if (typeof DeviceOrientationEvent?.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission().then(s => { if(s==='granted') startMotion(); });
      } else { startMotion(); }
    } else {
      useMotion = false; gX = 0; gY = 0;
      document.getElementById('motionBtn').innerText = "MOTION: OFF";
      document.getElementById('motionBtn').classList.remove('active');
    }
  }

  function startMotion() {
    useMotion = true;
    document.getElementById('motionBtn').innerText = "MOTION: ON";
    document.getElementById('motionBtn').classList.add('active');
    window.addEventListener('deviceorientation', e => {
      if(!useMotion) return;
      gX = e.gamma / 15; gY = e.beta / 15;
    });
  }

  function update() {
    let activeSpeed = 0;
    dice.forEach(d => {
      d.vx += gX; d.vy += gY;
      d.vx *= friction; d.vy *= friction;
      d.x += d.vx; d.y += d.vy;

      // 邊界反彈
      if(d.x < 0) { d.x = 0; d.vx *= -bounce; }
      if(d.x > window.innerWidth - 64) { d.x = window.innerWidth - 64; d.vx *= -bounce; }
      if(d.y < 0) { d.y = 0; d.vy *= -bounce; }
      if(d.y > window.innerHeight - 64) { d.y = window.innerHeight - 64; d.vy *= -bounce; }

      d.rx += d.vy * 3; d.ry += d.vx * 3;
      d.el.style.transform = `translate3d(${d.x}px, ${d.y}px, 0)`;
      d.c.style.transform = `rotateX(${d.rx}deg) rotateY(${d.ry}deg)`;
      
      activeSpeed += Math.abs(d.vx) + Math.abs(d.vy);
    });

    // 動態光影跟隨第一個骰子
    document.body.style.setProperty('--light-x', `${(dice[0].x / window.innerWidth)*100}%`);
    document.body.style.setProperty('--light-y', `${(dice[0].y / window.innerHeight)*100}%`);

    // 停止判定
    if (isRolling && activeSpeed < 0.5) {
      isRolling = false;
      showResult();
    }
    requestAnimationFrame(update);
  }

  function showResult() {
    const hr = new Date().getHours();
    let list = menuData.evening;
    let period = "Dinner Selection";
    
    if(hr >= 5 && hr < 11) { list = menuData.morning; period = "Breakfast Selection"; }
    else if(hr >= 11 && hr < 17) { list = menuData.noon; period = "Lunch Selection"; }
    else if(hr >= 22 || hr < 5) { list = menuData.midnight; period = "Midnight Selection"; }

    const food = list[Math.floor(Math.random()*list.length)];
    const nameEl = document.getElementById('food-name');
    const subEl = document.getElementById('food-sub');
    
    nameEl.innerText = food;
    subEl.innerText = period;
    nameEl.style.opacity = 1;
    subEl.style.opacity = 1;

    // 骰子歸位動畫（修正回正確的面）
    dice.forEach(d => {
      d.c.style.transition = "transform 1s ease-out";
      d.c.style.transform = `rotateX(0deg) rotateY(0deg)`;
      setTimeout(() => { d.c.style.transition = "none"; }, 1000);
    });
  }

  update();
</script>
</body>
</html>
