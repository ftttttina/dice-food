<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DESTINY - MONO GRAVITY</title>
  <style>
    :root {
      --bg-dark: #000000;
      --glow-color: rgba(255, 255, 255, 0.05);
      --dice-glass: rgba(255, 255, 255, 0.08);
    }

    body {
      margin: 0; padding: 0; height: 100vh; width: 100vw;
      background-color: var(--bg-dark);
      overflow: hidden; font-family: "SF Pro Display", sans-serif;
      color: #fff;
    }

    /* --- 找回呼吸感：動態光暈層 --- */
    #ambient-bg {
      position: absolute; width: 100%; height: 100%;
      background: 
        radial-gradient(circle at 50% 50%, #1a1a1c 0%, #000 70%),
        radial-gradient(circle at var(--gx, 50%) var(--gy, 50%), rgba(255,255,255,0.08) 0%, transparent 40%);
      animation: breathe 8s infinite alternate ease-in-out;
      z-index: 0;
    }

    @keyframes breathe {
      0% { opacity: 0.6; transform: scale(1); }
      100% { opacity: 1; transform: scale(1.1); }
    }

    /* --- 物理物件與層級 --- */
    #world { position: absolute; width: 100%; height: 100%; z-index: 1; pointer-events: none; }

    .header {
      position: absolute; top: 12vh; width: 100%; text-align: center;
      letter-spacing: 15px; opacity: 0.8; z-index: 5;
    }
    h1 { font-weight: 200; font-size: 0.85rem; margin: 0; text-transform: uppercase; }

    .dice-container { position: absolute; width: 66px; height: 66px; }
    .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; }
    .cube div {
      position: absolute; width: 66px; height: 66px;
      background: var(--dice-glass);
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.15); border-radius: 14px;
      box-shadow: inset 0 0 15px rgba(255,255,255,0.03);
      display: grid; padding: 10px; box-sizing: border-box;
    }

    .dot { width: 10px; height: 10px; background: rgba(255,255,255,0.85); border-radius: 50%; align-self: center; justify-self: center; }
    .f1 .dot { background: #fff; box-shadow: 0 0 12px #fff; }

    /* 標準點數佈局 (簡化示例，實際包含1-6面) */
    .f1 { transform: rotateY(0deg) translateZ(33px); }
    .f6 { transform: rotateY(180deg) translateZ(33px); }
    .f2 { transform: rotateX(90deg) translateZ(33px); }
    .f5 { transform: rotateX(-90deg) translateZ(33px); }
    .f3 { transform: rotateY(90deg) translateZ(33px); }
    .f4 { transform: rotateY(-90deg) translateZ(33px); }

    /* --- UI 按鈕 --- */
    .footer {
      position: absolute; bottom: 8vh; width: 100%;
      display: flex; flex-direction: column; align-items: center; z-index: 10;
    }
    #result { 
      font-size: 1.5rem; font-weight: 200; letter-spacing: 5px; 
      margin-bottom: 30px; min-height: 40px; opacity: 0; transition: 1s;
    }
    .glass-btn {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2);
      color: #fff; padding: 15px 50px; border-radius: 40px;
      font-size: 0.7rem; letter-spacing: 3px; backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>
<body>

<div id="ambient-bg"></div>

<div class="header"><h1>Destiny Dinner</h1></div>

<div id="world">
  <div id="d1" class="dice-container"><div class="cube" id="c1">
    <div class="f1"><span class="dot"></span></div>
    <div class="f6" style="display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
    </div></div>
  <div id="d2" class="dice-container"><div class="cube" id="c2">
    <div class="f1"><span class="dot"></span></div>
    <div class="f6" style="display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr 1fr;"><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
  </div></div>
</div>

<div class="footer">
  <div id="result"></div>
  <button class="glass-btn" onclick="requestPermission()">START ENGINE</button>
</div>

<script>
  let dice = [
    { id: 'd1', cId: 'c1', x: 100, y: 300, vx: 0, vy: 0, rx: 0, ry: 0 },
    { id: 'd2', cId: 'c2', x: 250, y: 350, vx: 0, vy: 0, rx: 0, ry: 0 }
  ];

  let gX = 0, gY = 0;
  const bounce = 0.5;
  const friction = 0.98;

  function requestPermission() {
    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      DeviceOrientationEvent.requestPermission().then(s => { if(s==='granted') init(); });
    } else { init(); }
  }

  function init() {
    window.addEventListener('deviceorientation', e => {
      gX = e.gamma / 30; gY = e.beta / 30;
      // 背景隨重力微動
      document.body.style.setProperty('--gx', `${50 + e.gamma/2}%`);
      document.body.style.setProperty('--gy', `${50 + e.beta/4}%`);
    });
    // 初次搖晃
    shake();
    update();
    document.querySelector('.glass-btn').innerText = "SHAKE";
    document.querySelector('.glass-btn').onclick = shake;
  }

  function shake() {
    dice.forEach(d => { d.vx += (Math.random()-0.5)*40; d.vy += (Math.random()-0.5)*40; });
    document.getElementById('result').style.opacity = 0;
  }

  function update() {
    dice.forEach(d => {
      d.vx += gX; d.vy += gY;
      d.vx *= friction; d.vy *= friction;
      d.x += d.vx; d.y += d.vy;

      if(d.x < 0 || d.x > window.innerWidth-66) { d.vx *= -bounce; d.x = d.x<0?0:window.innerWidth-66; }
      if(d.y < 0 || d.y > window.innerHeight-66) { d.vy *= -bounce; d.y = d.y<0?0:window.innerHeight-66; }

      d.rx += d.vy * 2; d.ry += d.vx * 2;
      document.getElementById(d.id).style.transform = `translate3d(${d.x}px, ${d.y}px, 0)`;
      document.getElementById(d.cId).style.transform = `rotateX(${d.rx}deg) rotateY(${d.ry}deg)`;
    });

    requestAnimationFrame(update);
  }
</script>
</body>
</html>
